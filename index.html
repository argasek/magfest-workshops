<!doctype html>
<html>
<head>
  <title>Demoscene workshops</title>
  <style type="text/css">
    canvas {
      border: 1px solid black;
      image-rendering: pixelated;
    }
  </style>
</head>
<body>
  <canvas id="tutorial" width="640" height="480"></canvas>
  <script>
    const canvas = document.getElementById('tutorial');
    const ctx = canvas.getContext('2d');
    const imageData = ctx.createImageData(1, 1);

    const putPixel = (x, y, r, g, b, a = 255) => {
      ctx.fillStyle = "rgba("+r+","+g+","+b+","+(a/255)+")";
      ctx.fillRect( x, y, 1, 1 );
    };

    const drawTexture = (x = 0, y = 0, texWidth, texHeight) => {
      for (let i = y, a = 0; i < texHeight + y; i++, a++) {
        for (let j = x, b = 0; j < texWidth + x; j++, b++) {
          const color = (a * 256 / texWidth) ^ (b * 256 / texHeight);
          putPixel(j, i, color, color, color);
        }
      }
    };

    const precalculateDistanceTable = (w, h, texWidth, texHeight) => {
      const ratio = 32.0;

      for (let x = 0; x < w; x++) {
        for (let y = 0; y < h; y++) {
          const xw = (x - w / 2.0);
          const yh = (y - h / 2.0);
          const distance = Math.trunc((ratio * texHeight / Math.sqrt(xw * xw + yh * yh)) % texHeight);
          putPixel(x, y, distance, distance, distance);
        }
      }
    };

    function atan2Normalized(y, x) {
      let result = Math.atan2(y, x);
      if (result < 0) {
        result += (2.0 * Math.PI);
      }
      return(result);
    }

    const precalculateAngleTable = (w, h, texWidth, texHeight) => {
      for (let x = 0; x < w; x++) {
        for (let y = 0; y < h; y++) {
          const xw = (x - w / 2.0);
          const yh = (y - h / 2.0);
          // atan2(y,x) returns an angle in range [-π, π] for x axis and a given point
          const angle = Math.trunc((0.5 * texWidth * (atan2Normalized(yh, xw) / Math.PI)));
          putPixel(x, y, angle, angle, angle);
        }
      }
    };

    precalculateAngleTable(640, 480, 256, 256)

  </script>
</body>
</html>
